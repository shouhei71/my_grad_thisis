%%%%
\chapter{測定手法}
gosi
\section{Cassandraの概要}
 ・メンバーシップ周り？
 ・seedの説明
 ・データ保管部分の解説
 ・ある特定のポートで通信を行なっている。
・cassandraは,IPアドレスのみでノードを判定している。
 
\section{Cassandraの軽量化}
実験に当たって、物理リソースからの都合上1台あたり複数の Cassandra ノー ドを起動する必要があった。デフォルトの設定で、オリジナルのCassandra一台起動するには、データをまっタック入れない状態で、スレッド数が130程度、メモリー150M程度消費する。多数のノードを立ち上げるためにデータ保持部分のプログラムの改変と、設定ファイルのパラメータ調整を行った。
\subsection{プログラムの改変}
Cassandraでは、何もデータが入れない状態であっても,Systemなんちゃらを各ノードで保持すること、時間が経つと徐々にOnmemory上にmemtable?とかが増えてしまことで、メモリー使用量域がかさむ。私の実験に関しては、実データがどのようなものかは関係がないので、このようなデータを小さく保持する必要があった。そこどえ、実際のデータを保存するのではなく、データサイズだけを保管するように変更した。その結果メモリー使用量域がへった。(具体的には、絶対的に減っていくつになった。2.時間がたっても増えにくいこととをアピール)
\subsection{設定ファイルのパラメータ調整}
また、設定パラメータを調節した。Cassandraは、write、read時のスレッド数を制限することで
スレッド数を130 ->  100に落とした。

\section{実験シナリオ}
実験では一台あたり複数の Cassandra ノー ドを起動した10台のマシンを利用し、通信量の測定を行った。各Cassandraの起動、通信量の測定は、シェルスクリプトでプログラムを書き制御した。

\subsection{実験環境}
以下に実験環境を示す。
\begin{itemize}
\item Cassandra 0.6.6	
\item OS: Linux	 2.6.35.10-74.fc14.x86_64
\item Java 仮想マシン: Java SE 6 Update 21
\item CPU: 2.40 GHz Xeon E5620 × 2
\item メモリー: 32GB RAM
\item ネットワーク: 1000BASE-T
\end{itemize}
\subsection{計測方法について}
・ipaliaslingをかけてネットワークを構成したこと\\
Cassandraでは、IPアドレスだけでノードを管理している。つまり、今回のように、一台あたり複数台のCassandraを単純に立ち上げると、不都合が生じる。そこで、IPAliaslingを使って、仮想アドレスを作成し、Cassandraノードごとに割り振った。これにより、同じマシン上に立ち上がったCassandraマシンが判別でき、不整合が起きなくなった。
通信量の測定の際には、ノイズを防がないといけない。ノイズとは、Cassandraノード以外から要求されるリクエストのことである。具体的には、ARPとか、PINGとかある。これらを誤って計測することを避けるためにIPAliaslingを行うと同時に、CassandraNodeに割り振られたIPアドレスだけが含まれるpribate networkを構築し、ノイズを減らした。(なくした?)
(IPAliasの図でも載せておく？？？)

・tcpdumpをしよう。\\
通信量の測定は、tcpdumpを使用した。上述したように、Cassandra Node同士のやりとりは、プライベートネットワーク上で行われるため、このネットワークをまたぐTCPパケットのサイズを記録した。(具体的には、とか書いとく？)
tcpdump 10.20.........

このコマンドを各マシンで実行することで、外部のマシン上で実行されているCassandraNodeからの通信を計測することができる。

\section{通信量の測定について}
しかしながら、この計測方法では同じマシン上でのCassandraNode同士の通信を計測することはできない。だが、計測した総通信量からCassandra Nodeで発生する総通信量を計測できることを示す。\\
ここで、一つ仮定を立てる。\\
・任意のCassandra Node同士の通信量は平均すると同じ！(言葉をおきかえる!)\\
この仮説をもとにすると、n台の各マシンでm台のcassandra nodeを起動したとする。
(つまり、合計 n × m台のCassandraノードを立ち上げたとする)さらに、上のように、各マシンでtcpdumpを使用して計測した得られたトラフィックの合計をTとおき、Cassandra nodeで発生するそう通信量TTとく。(n-1) * m台のcassandra nodeで発生している通信量が Tであるので、仮説を使うと、n * m台の場合は、\\
	TT = T * (n * m ) / ((n-1) * m ) = T * n / (n-1)\\
となる。
具体的に、n = 10台の時について、図を使いながら解説する。
(図を使おう)



