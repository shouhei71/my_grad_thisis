%%%%
\chapter{Cassandraについて}
\section{Cassandraの概要}
Apache Cassandraは、Facebook社によって開発され、Apacheプロジェクト \cite{CassandraWiki}としてオープンソース化されたクラウドストレージである。
複数のデータセンター上に分散して配置された数百ノードで構成されることを想定しており、高い可用性と単一故障点を持たない非集中な分散モデルが大きな特徴である。
このような大規模な環境では平均故障間隔は短く、故障検知が重要である。
\subsection{メンバーシップ管理}
Cassandraを構成する各ノードは、リング上ID空間に配置される。
各ノードは、クラスタに参加しているすべてのメンバーをgossipにより把握する。
また新規ノードを追加する時は、最初にコンタクトを取るノードの (これをseedと呼ぶ) 情報を予め設定しておくことで、スムーズにシステムに参加できる。
メンバーシップ管理は、上述したgossipプロトコルの応用であるScuttlebuttをベースに行っている。
ここでは、Scuttlebuttを使用したノード同士の情報交換をgossip通信とする。
具体的には、以下の手順に沿って毎秒情報交換が行われている。
\begin{enumerate}
\item STEP1: ランダムで生存ノードを一つ選択してgossip通信を行う。
\item STEP2: 生存ノード数と故障が疑われるノード数に応じたある確率で、故障が疑われるノードをランダム一つ選択しgossip通信を行う。
\item STEP3: STEP1でseed以外にgossip通信を行ったとき、あるいはseedのノード数より生存ノードが少ないときのみを対象とする。この時、生存ノード、seed、故障が疑われるノードの数に応じたある確率で、seedの中からランダムで一つを選択してgossip通信を行う。
\end{enumerate}
スタンドアロン形式でCassandraノードを立ち上げる場合を除き、この方式により毎秒1$\sim$3回のgossip通信を行っている。