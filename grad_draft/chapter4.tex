%%%%
\chapter{Cassandraについて}
\section{Cassandraの概要}
Cassndraは大量の構造化データを管理する分散ストレージシステムである。地理的に離れて分散された数百ノードからなる商用サーバー上で運用されることが想定されていて、可用性の高いサービスを提供し、単一故障点を持たない。このようなスケールでは大小の故障はひっきりなしに起こる。このように故障がひっきりなしに起きる状況においても、カサンドラは一貫した状態を保つのよう設計されているので、信頼性、スケーラビリティも高い。また、カサンドラはリレーショナルデータモデルを採用していない。そのかわりに動的にデータのレイアウトとフォーマットを制御できるシンプルなデータモデルを提供する。よって、読み書き効率を下げることなく高い書き込みスループットを実現している。

Cassandraは、2008年にFacebookによってオープンソースとなり、Avinash Lakshman (Amazon Dynamoの作者のうちの一人)と、Prashant Malik (Facebookエンジニア)によって設計されました。Cassandraは、Amazon DynamoとGoogle BigTableの融合によって生まれたものであり、Dynamo 2.0とも考えることができます。Cassandraは、Facebookにおけるプロダクション用途にあるが、まだ発展途上のプロダクトです。(wikiより。)

以下、本研究の関連がある点について述べる。

\subsection{Cassandraのメンバーシップ管理について}
(seedの説明も必要か。)\\
\subsection{Cassandraの故障検知について}
 (もしかしたらリングの図とかはいるかもね。)
\subsection{Cassandraのデータ保存部分}
(データ保存も改良した。関連する部分を解説。)
\subsection{Cassandraノードの判別}
・cassandraは,IPアドレスのみでノードを判定している。\\
 (もしやこのセクションではない？)
 
\section{Cassandraの軽量化}
(TODO1:具体的に数値を細かくだそうか。)
(TODO2:具体的に数値は環境依存だが、どう書く？)
実験を行うにあたって物理リソースの都合上、1台あたり複数の Cassandra ノー ドを起動する必要があった。デフォルトの設定では、１ノードのCassandra起動するためには、データを全く保持していない状態で、スレッド数が130、メモリー使用領域が、150M程度消費する。1台あたり多数のノードを立ち上げるために、データ保持部分のプログラムの改変と、設定ファイルのパラメータの調整を行った。
\subsection{プログラムの改変}
(TODO1:具体的に数値を細かく?)\\
Cassandraでは、何もデータを保持していない状態であっても,システム管理のためのテーブルを保持している。また、時間が経つと徐々にOnmemory上にmemtableとかが増えてしまことで、メモリー使用量域がかさむ。以下の点を踏まえて、メモリー使用領域を減らすために改変を加える。\\
私の実験では、実データがどのようなものかは関係がない。そこで、実際のデータを保存するのではなく、データサイズだけを保管するように変更した。その結果メモリー使用量域が減った。
また、時間が経過しても増加する量が抑えられた。

\subsection{設定ファイルのパラメータ調整}
(TODO2:現状は、非常に怪しい[column familyの定義を減らしたのが聞いてるだけってのもありうる。])\\
Cassandra１ノードで使用するスレッドは非常に多い。できるだけスレッド数を減らすために設定ファイルを変更した。具体的には、Cassandraが起動時に呼び込むstorage.confというファイルである。変更したパラメータは、\\
\begin{itemize}
\item $concurrent_reads$ : いくつまで同時読み込みを許すしきい値
\item $concurrent_writes$: いくつまで同時書き込みを許すしきい値
\end{itemize}
このパラメータは,Cassandra(の？)で使用するスレッド数に直結するので、この数を32 - > 2 ,132 - > 2と減らすことで、全体のスレッド数をを130 ->  100に落とした。


