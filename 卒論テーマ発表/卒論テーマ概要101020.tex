\documentclass[a4j]{jsarticle}

%\usepackage{mathpazo}

\usepackage[dvipdfm]{graphicx}
%\usepackage{epsf}

%\usepackage[margin=2.5cm]{geometry}
%\setlength{\textwidth}{169.2mm}
%\setlength{\oddsidemargin}{-5.0mm}
%\setlength{\evensidemargin}{-5.0mm}
%\setlength{\topmargin}{-10.0mm}
%\setlength{\topmargin}{-10mm}
%\setlength{\oddsidemargin}{-10mm}
%\setlength{\textwidth}{245mm}
%\setlength{\textheight}{250mm}


\begin{document}

\title{卒論の研究内容について}
\author{奥寺昇平}
\date{2010年10月22日}
\maketitle

%\epsfile{file=DSCF2974.eps}

%\begin{figure}[htbp]
%\begin{center}
%\includegraphics*{
%DSCF2974.eps}
%\end{center}
%\caption{caption}
%\end{figure}
%\setcounter{section}{5}
\section{研究目的}
長尾さんが卒論で考案した、経路表(データのキーとその担当ノードの一覧表)管理アルゴリズムのFRTの効果を測定することが研究目的である。前期に取り組んだ課題に引き続き、Cassnadraという分散システムにFRTを導入し、その効果を測定する。想定する環境としては、ノードの数、ノードの出し入れの頻度をパラメータにする。\\
 \section{目標}
 \begin{enumerate}
\item オリジナルのCassandraと同等の機能をもつ、Cassandraを実装する。\\
-前期の課題の段階では、データの複製戦略や、一貫性レベルを調整する機能が使えなかった。\\
-データの複製戦略の実装の工夫が必要である。\\
\item オリジナルのCassandraをベースにして、新たに作成したCassandraを性能比較する。\\
-ノードの数、ノードの出し入れの頻度をパラメータにする。特に、ノードの数が多く、ノードの出し入れの頻度が高い条件の時、性能が出ることを予想する。\\

\end{enumerate}

 \section{Cassandraとは}
 米Facebook社が自社のSNSのインフラとして開発した、大量の商用サーバーに広がる大量の構造化データを扱う分散ストレージシステムである。\\

2008年にソースコードがオープンソースとして公開されています。オーバレイネットワーク上に連想配列(key-value)を構築する技術であるDHTを用いて、
データを複数ノードに分散して配置する。ノードと、データのキーには、リング上のID空間の座標Tokenが一つ割り当てられていて、あるデータの担当ノードは、「前のノードのToken ＜ データのToken ＜＝ ノードのToken」を満たすノードに決定されます。このノードがデータの主担当で、さらに複製として、IDが大きくなる方向に主担当から設定された分の数のノードが同じデータを保存します。これがデータの複製方法です。\\

次に、Cassandraの(データの)ルーティングの方法について説明する。Cassandraクラスタを構成するノード群は、Gossipと呼ばれるプロトコルを利用して随時ノード情報を取得し、ノード情報を最新の状態に保っている。read/write等のリクエストをクライアントから受けると、そのノードが担当するノードを決定し、リクエストを転送する仕組みになっている。

 
\section{前期で取り組んだこと}
前期の課題は、長尾さんが卒論で考案した、柔軟に経路表を管理するアルゴリズムFRTをCassandraに導入することが目的であった。\\
\\
FRTでは、設定数以上のノードを経路表に登録しようとしたとき、適切な経路情報だけを残して経路表から削除してしまうので、各ノードが持つ経路情報は、完全なものではなくなる。そこで、シングルホップから、リクエストがノード間を経由して最終的に担当ノードにたどり着くマルチホップシステムを採用し、データを取得できるようにした。前期の段階では、データの複製については考慮していなかった。そこで、この複製についてこれから特に取り組んでいく。\\


 \section{想定仕様(データ複製の方法)}
 ここではデータ複製を考慮したread時のオペレーションについて、そのアイディアを説明する。
\begin{itemize}
\item 現状のCassandra \\
\begin{itemize}
\item 【条件】\\
・クラスターを構成するあらゆるノードが、完璧な経路表情報(データのキーとその担当ノードの一覧表)を持っている。\\
\item【手順】\\
1.Proxy(クライアントからリクエストを受けたノード)が担当ノードを指定する。\\
2.proxyからリクエストをもらった担当ノードは、データの要約を返す。IPアドレス的に近い担当ノードからは、同時にデータも取得する。\\
3.proxyは担当ノード群からもらったデータの要約を照らし合わせ、一貫性がとれているならば、
そのデータを返す。一貫性がとれていなかったり、データが古かったら、最新のデータがクライアントに渡せるように、一貫性の調整を行い、データを再取得し、クライアントにデータを渡す。\\
\end{itemize}



\item 新しく作るCassandra 
\begin{itemize}
\item 【条件】\\
・どのノードも、完璧な経路表情報(データのキーとその担当ノードの一覧表)を持ってない。\\
しかし、自らのノードの(リング上のID的に)近傍のノード情報については完全に知っている。(そのように設定しておく)\\
\item【手順】\\
1.マルチホップで主担当ノードへ到達する。\\
2.主担当ノードは、近傍のノード情報については完全に知っているので、キーに対するレプリカの位置情報を取得でき、これをProxyに送ります。\\
3.Proxyは、その位置情報を元に、リクエストを投げ、データの要約を受け取る。\\
4.データの要約を照らし合わせ、一貫性がとれているならば、IPアドレス的に近い担当ノードからデータを要求し、クライアントにデータを渡す。一貫性がとれていない場合、最新のデータがクライアントに渡すと同時に、一貫性の調整を行います。一貫性の調整と実データ取得は別プロセスで行います。\\

\end{itemize}

\item メリット、デメリット
\begin{itemize}
\item 【メリット】\\
・クライアントにデータを返す時間が短い。\\
新しく作るCassandraでは、担当ノード群すべてからデータの要約のみをもらうので、担当ノードにアクセスしてから一貫性チェックを開始するまでの時間がはやい。結果として、クライアントにデータを返す時間が短縮できる機会が増える。\\
つまり、オリジナルのCassandraのやり方では、データの要約をリクエストすると同時に、必ず一つのノードからは、データ本体を取得しないといけない。そのデータ量が多いと、転送時間に時間がかかるのである。\\
オリジナルのCassandraで取得したデータが最新のものであれば、すぐクライアントにデータを渡せるので、新しく作るCassandraと同等だが、データが最新ではなかった場合は、再度最新のデータを持っているノードにデータを要求するため、さらに時間がかかるのである。その分、新しいCassandraでは、データ本体を転送するのは必ず１回だけなので、クライアントにデータを帰す時間は短い。\\
・ルーティング時のホップ数が平均O(LogN)で押さえられる。(全体のノード数をNとする。)\\
\item【デメリット】\\
・ルーティング時のホップ数がO(1)から平均O(LogN)に上昇する。(全体のノード数をNとする。)\\
\end{itemize}
\end{itemize}


\end{document}